<div class="admin-dashboard" *ngIf="isAdmin">
    <div class="dashboard-header">
      <h1>🔧 Panel de Administración</h1>
      <div class="last-update">
        Última actualización: {{ getLastUpdate() }}
      </div>
      <div class="optimization-status" *ngIf="!isLoading">
        <span class="status-indicator" [class]="isHighLoad ? 'high-load' : 'normal-load'">
          {{ isHighLoad ? '⚠️ Alta Carga' : '✅ Carga Normal' }}
        </span>
        <span class="cache-info">
          📦 Caché: {{ metricsCache?.size || 0 }} entradas
        </span>
      </div>
    </div>

    <!-- Indicador de carga -->
    <div class="loading-indicator" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Cargando métricas del sistema...</p>
    </div>

    <!-- Estado de la Aplicación -->
    <div class="metric-card" *ngIf="!isLoading">
      <h3>📱 Estado de la Aplicación</h3>
      <div class="metric-grid">
        <div class="metric-item">
          <span class="label">Estado:</span>
          <span class="value" [class]="metrics?.app?.status === 'UP' ? 'status-up' : 'status-down'">
            {{ metrics?.app?.status || 'N/A' }}
          </span>
        </div>
        <div class="metric-item">
          <span class="label">Uptime:</span>
          <span class="value">{{ formatUptime(metrics?.app?.uptime || 0) }}</span>
        </div>
        <div class="metric-item">
          <span class="label">Horario:</span>
          <span class="value">{{ metrics?.app?.schedule || 'N/A' }}</span>
        </div>
        <div class="metric-item">
          <span class="label">Versión:</span>
          <span class="value">{{ metrics?.app?.version || 'N/A' }}</span>
        </div>
      </div>
    </div>

    <!-- Métricas de Memoria -->
    <div class="metric-card" *ngIf="!isLoading">
      <h3>💾 Memoria del Sistema</h3>
      <div class="metric-grid">
        <div class="metric-item">
          <span class="label">Usada:</span>
          <span class="value">{{ metrics?.memory?.used || 0 }} MB</span>
        </div>
        <div class="metric-item">
          <span class="label">Máxima:</span>
          <span class="value">{{ metrics?.memory?.max || 0 }} MB</span>
        </div>
        <div class="metric-item">
          <span class="label">Porcentaje:</span>
          <span class="value" [class]="getMemoryClass(metrics?.memory?.percentage || 0)">
            {{ metrics?.memory?.percentage?.toFixed(1) || '0.0' }}%
          </span>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="metrics?.memory?.percentage || 0"></div>
      </div>
    </div>

    <!-- Métricas de CPU -->
    <div class="metric-card" *ngIf="!isLoading">
      <h3>⚡ CPU</h3>
      <div class="metric-grid">
        <div class="metric-item">
          <span class="label">Uso:</span>
                  <span class="value" [class]="getCpuClass(metrics?.cpu?.usage || 0)">
          {{ (metrics?.cpu?.usage || 0) | number:'1.1-1' }}%
        </span>
        </div>
        <div class="metric-item">
          <span class="label">Carga:</span>
          <span class="value" [class.unavailable]="!metrics?.cpu?.loadAvailable">
            {{ metrics?.cpu?.loadAvailable ? (metrics?.cpu?.load?.toFixed(2) || '0.00') : 'No disponible' }}
          </span>
          <span class="status-indicator" *ngIf="!metrics?.cpu?.loadAvailable">
            ⚠️
          </span>
        </div>
        <div class="metric-item">
          <span class="label">Núcleos:</span>
          <span class="value">{{ metrics?.cpu?.cores || 1 }}</span>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill cpu-progress" [style.width.%]="(metrics?.cpu?.usage || 0)"></div>
      </div>
    </div>

    <!-- Análisis Detallado del Disco -->
    <div class="metric-card disk-analysis-card" *ngIf="!isLoading">
      <ng-container *ngIf="getDiskAnalysis() as diskAnalysis">
        <div class="card-header">
          <h3>💿 Análisis del Disco del Sistema</h3>
                            <div class="header-actions">
                    <button class="btn btn-sm btn-outline-primary" (click)="refreshDiskAnalysis()" [disabled]="isLoading">
                      🔄 Actualizar
                    </button>
                    <button class="btn btn-sm btn-outline-warning" (click)="performDiskCleanup()" [disabled]="isLoading">
                      🧹 Limpiar
                    </button>
                  </div>
        </div>
        
        <!-- Estado del Disco -->
        <div class="disk-status" [class]="isDiskCritical() ? 'critical' : 'normal'">
          <div class="status-header">
            <span class="status-indicator">
              {{ isDiskCritical() ? '🚨 CRÍTICO' : '⚠️ ALTO' }} - {{ metrics?.disk?.percentage?.toFixed(1) || '0.0' }}% usado
            </span>
          </div>
          <div class="disk-info">
            <span>Total: {{ metrics?.disk?.total || 0 }} GB</span>
            <span>Usado: {{ metrics?.disk?.used || 0 }} GB</span>
            <span>Libre: {{ diskAnalysis.freeSpace || 0 }} GB</span>
          </div>
        </div>

        <!-- Barra de Progreso -->
        <div class="progress-bar">
          <div class="progress-fill disk-progress" [style.width.%]="metrics?.disk?.percentage || 0"></div>
        </div>

        <!-- Principales Consumidores -->
        <div class="disk-consumers" *ngIf="diskAnalysis.topConsumers && diskAnalysis.topConsumers.length > 0">
          <h4>🔍 Principales Consumidores de Espacio</h4>
          <div class="consumer-list">
            <div class="consumer-item" *ngFor="let consumer of diskAnalysis.topConsumers">
              <div class="consumer-path">
                <span class="path-icon">{{ getPathIcon(consumer.type) }}</span>
                <span class="path-text">{{ consumer.path }}</span>
              </div>
              <div class="consumer-details">
                <span class="consumer-size">{{ consumer.sizeFormatted }}</span>
                <span class="consumer-percentage">{{ consumer.percentage }}%</span>
              </div>
              <div class="consumer-description">{{ consumer.description }}</div>
            </div>
          </div>
        </div>

        <!-- Rutas Críticas -->
        <div class="critical-paths" *ngIf="diskAnalysis.criticalPaths && diskAnalysis.criticalPaths.length > 0">
          <h4>🚨 Rutas Críticas Requieren Atención</h4>
          <div class="path-list">
            <div class="path-item" *ngFor="let path of diskAnalysis.criticalPaths">
              ⚠️ {{ path }}
            </div>
          </div>
        </div>

        <!-- Última Actualización -->
        <div class="last-analysis">
          <small>Último análisis: {{ diskAnalysis.lastAnalysis | date:'short' }}</small>
        </div>
      </ng-container>
    </div>

    <!-- Acciones de Administración -->
    <div class="metric-card" *ngIf="!isLoading">
      <h3>⚙️ Acciones</h3>
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="refreshMetrics()" [disabled]="isLoading">
          🔄 Actualizar Métricas
        </button>
        <button class="btn btn-warning" (click)="clearCache()" [disabled]="isLoading">
          🗑️ Limpiar Caché
        </button>
        <button class="btn btn-info" (click)="exportMetrics()" [disabled]="isLoading">
          📊 Exportar Reporte
        </button>
        <button class="btn btn-secondary" (click)="showDiagnosticAlert()" [disabled]="isLoading">
          🔍 Diagnóstico
        </button>
        <button class="btn btn-success" (click)="testEndpoints()" [disabled]="isLoading">
          🧪 Probar Endpoints
        </button>
        <button class="btn btn-dark" (click)="showPerformanceStats()" [disabled]="isLoading">
          🚀 Rendimiento
        </button>
      </div>
    </div>

  </div>

  <div class="access-denied" *ngIf="!isAdmin">
    <h2> Acceso Denegado</h2>
    <p>No tienes permisos para acceder a esta sección.</p>
    <p>Para acceder, usa: <code>/admin?token=admin123</code></p>
    <button class="btn btn-primary" (click)="goToLogin()">Ir al Login</button>
  </div>