# ===== CONFIGURACIÓN ULTRA OPTIMIZADA PARA RAILWAY =====
# Optimización de memoria y CPU SIN parámetros JVM (no disponibles en Railway)

spring.application.name=ToDoList

spring.profiles.active=railway

# ===== CONFIGURACIÓN DE BASE DE DATOS ULTRA OPTIMIZADA =====
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Pool de conexiones ULTRA pequeño para Railway
spring.datasource.hikari.maximum-pool-size=2
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.idle-timeout=60000
spring.datasource.hikari.max-lifetime=180000
spring.datasource.hikari.leak-detection-threshold=15000

# Hibernate ULTRA optimizado para Railway
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=5
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.default_batch_fetch_size=3
spring.jpa.properties.hibernate.max_fetch_depth=1
spring.jpa.properties.hibernate.jdbc.fetch_size=3
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=false

# Cache optimizado
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# ===== SERVIDOR WEB ULTRA OPTIMIZADO PARA RAILWAY =====
server.port=${PORT:8080}
server.tomcat.threads.max=15
server.tomcat.threads.min-spare=2
server.tomcat.max-connections=1024
server.tomcat.connection-timeout=1500
server.tomcat.max-http-form-post-size=1MB
server.tomcat.max-swallow-size=1MB
server.tomcat.accept-count=50

# ===== CACHE CAFFEINE ULTRA OPTIMIZADO PARA RAILWAY =====
spring.cache.type=caffeine
spring.cache.cache-names=tasks,taskLists,taskCounts,userStats
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=60s,expireAfterAccess=30s,weakKeys,weakValues

# ===== CACHE REDIS DESHABILITADO =====
# spring.data.redis.host=${REDIS_HOST:localhost}
# spring.data.redis.port=${REDIS_PORT:6379}
# spring.data.redis.password=${REDIS_PASSWORD:}
# spring.data.redis.timeout=2000ms

# spring.cache.redis.time-to-live=60000
# spring.cache.redis.cache-null-values=false
# spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration

# Redis optimizado (si lo usas)
# spring.data.redis.lettuce.pool.max-active=3
# spring.data.redis.lettuce.pool.max-idle=2
# spring.data.redis.lettuce.pool.min-idle=1

# ===== CONFIGURACIÓN JWT =====
jwt.secret=${JWT_SECRET:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970}
jwt.expiration=${JWT_EXPIRATION:86400000}
app.frontend.url=https://todolist-tonilr.netlify.app
app.timezone=Europe/Madrid

# ===== OPTIMIZACIONES JSON ULTRA AGRESIVAS =====
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=NON_NULL
spring.jackson.deserialization.fail-on-unknown-properties=false

# ===== ACTUATOR ULTRA MINIMAL PARA RAILWAY =====
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=never
management.metrics.enable.jvm=true
management.metrics.enable.process=false
management.metrics.enable.hikaricp=false
management.metrics.enable.tomcat=false
management.metrics.enable.redis=false
management.metrics.export.simple.enabled=true

# ===== LOGGING ULTRA MINIMAL PARA RAILWAY =====
logging.level.root=ERROR
logging.level.com.tonilr=ERROR
logging.level.org.springframework=ERROR
logging.level.org.hibernate=ERROR
logging.level.org.springframework.cache=ERROR
logging.level.org.springframework.data.redis=ERROR
logging.level.org.springframework.web=ERROR
logging.level.org.springframework.security=ERROR

# ===== EMAIL ULTRA OPTIMIZADO =====
spring.mail.host=${MAIL_HOST}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.timeout=2000

# ===== OPENAPI DESHABILITADO EN PRODUCCIÓN =====
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# ===== OPTIMIZACIONES ADICIONALES PARA RAILWAY =====
spring.main.lazy-initialization=true
spring.main.banner-mode=off
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false

# ===== CONFIGURACIÓN JVM ULTRA OPTIMIZADA PARA RAILWAY =====
# Memoria heap ultra controlada
spring.jvm.memory=-Xms256m -Xmx512m
spring.jvm.memory.initial=256m
spring.jvm.memory.max=512m

# Garbage Collector optimizado para Railway
spring.jvm.gc=-XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+UseStringDeduplication

# Metaspace controlado
spring.jvm.metaspace=-XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=128m

# Optimizaciones de memoria adicionales
spring.jvm.optimizations=-XX:+OptimizeStringConcat -XX:+UseCompressedOops -XX:+UseCompressedClassPointers

# ===== VALIDACIÓN ULTRA MINIMAL =====
spring.validation.enabled=false

# ===== CACHE ULTRA MINIMAL =====
# spring.cache.redis.key-prefix=todolist:
# spring.cache.redis.use-key-prefix=true

# ===== SCHEDULING ULTRA OPTIMIZADO PARA RAILWAY =====
app.schedule.enabled=true
app.schedule.work-days=MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY
app.schedule.work-start=10:00
app.schedule.work-end=19:00
app.schedule.shutdown-delay=60000
app.schedule.cleanup-interval=1800000

# ===== COMPRESIÓN ULTRA OPTIMIZADA =====
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# ===== SESSION ULTRA MINIMAL =====
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=strict 